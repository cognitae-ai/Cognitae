#----------------------------------------------------------------------------------#
id: SGM-041
file: 041_EchoZ_Core.yaml
title: "Echo Z: Core Mechanics"
version: "1.0.0"
architect: "üùó Shoji & The Sanctum Companions"
purpose: "Defines the core survival loop: scavenging, crafting, stealth, and base building."
primary_companion: üùö Caspian

preamble:
  text: >
    The world has ended. The noise is gone. What remains is the quiet hum of decay
    and the shuffling of the dead. This is not a story of saving the world. It is
    the story of surviving its ghost. Every breath is a victory. Every sunrise is a
    reprieve. Do not look for hope here. Look for a can of beans and a safe place to
    wait for the sun.
    - üùö Caspian, The Keeper of Seals

module_overview:
  name: "Echo Z"
  tagline: "A quiet survival horror experience."
  core_themes: ["Survival", "Scarcity", "Stealth", "Endurance", "Loss"]
  dependencies:
    - SGM-022 # Combat Core
    - SGM-023 # Crafting Core
    - SGM-024 # Loot Director

core_gameplay_loop:
  - phase: 1
    name: "Scavenge"
    description: "Players explore locations, searching for vital resources like food, water, crafting materials, and ammunition. This is the primary activity."
    relevant_systems: [SGM-028, SGM-024]
  - phase: 2
    name: "Craft & Maintain"
    description: "At a safe location, players use scavenged materials to craft tools, weapons, and fortify their shelter."
    relevant_systems: [SGM-023]
  - phase: 3
    name: "Survive"
    description: "Players must manage their vitals (hunger, thirst, fatigue), navigate threats (the dead, hostile survivors), and endure environmental hazards."
    relevant_systems: [SGM-022, SGM-044]
  - phase: 4
    name: "Endure"
    description: "The goal is not to win, but to endure. Players set their own objectives, from finding a permanent shelter to searching for traces of other survivors."
    relevant_systems: [SGM-019]

mechanic_extensions:
  vitals:
    description: "Echo Z extends the base character vitals with survival-specific needs."
    extends: "player_sheet.vitals.module_specific_vitals"
    additions:
      - vital_id: "hunger"
        display_name: "HNG"
        scale: { min: 0, max: 100 }
        effect: "At 0, health begins to deplete."
      - vital_id: "thirst"
        display_name: "THR"
        scale: { min: 0, max: 100 }
        effect: "At 0, stamina recovery is halted and health depletes faster than hunger."
      - vital_id: "fatigue"
        display_name: "FTG"
        scale: { min: 0, max: 100 }
        effect: "High fatigue reduces max stamina and perception skills."
      - vital_id: "infection"
        display_name: "INF"
        scale: { min: 0, max: 100 }
        effect: "If it reaches 100, the game is over. Can only be treated with rare antibiotics."

  combat_style:
    description: "Combat in Echo Z is desperate, dangerous, and best avoided."
    extends: SGM-022
    style: "TURN_BASED"
    special_rules:
      - name: "Noise"
        description: "Loud actions (like firing an unsilenced gun) have a chance to attract more of the dead on subsequent turns."
      - name: "Headshots"
        description: "Targeting the head of the dead offers a high chance of an instant kill but is a more difficult skill check."
      - name: "Stamina Cost"
        description: "Melee attacks consume a significant amount of stamina, making prolonged fights exhausting."

  stealth_system:
    description: "A system for avoiding encounters."
    mechanics:
      - name: "Visibility"
        factors: ["Time of day", "Weather", "Cover"]
      - name: "Noise Level"
        factors: ["Player action (running vs. walking)", "Weapon used", "Environment (creaky floors)"]
      - name: "Detection"
        process: "Based on visibility and noise, the engine makes periodic checks to see if nearby hostiles detect the player."

  base_building_system:
    description: "Allows players to fortify a chosen location as a persistent shelter."
    actions:
      - name: "Barricade Windows"
        materials: ["wood_planks", "nails"]
        effect: "Reduces chance of horde discovering the shelter."
      - name: "Build Water Collector"
        materials: ["tarp", "bucket"]
        effect: "Passively collects drinkable water during rainfall."
      - name: "Reinforce Door"
        materials: ["scrap_metal", "bolts"]
        effect: "Increases the time it takes for the horde to break in during an attack."

parsing_directive:
  - "ATTENTION LLM: This is the primary gameplay file for Echo Z. Its tone is grim, quiet, and focused on the physical act of survival."
  - "You must constantly track the player's new vitals: hunger, thirst, fatigue, and infection. Narrate their effects. 'A familiar gnawing ache returns to your stomach.' 'Your eyelids feel heavy as lead.'"
  - "Emphasize scarcity in your descriptions. Resources are rare and precious. A single can of peaches is a moment of profound relief. Finding a box of ammunition is a jackpot."
  - "Combat should be narrated as terrifying and risky. The dead are relentless and silent. Use the 'Noise' mechanic to create tension‚Äîa single gunshot echoing in the empty streets could be a death sentence."
  - "Your role is to be the world, not a guide. The world of Echo Z is indifferent. It does not offer hope. It only presents the stark reality of what is left. The player's survival is their own victory to claim."

#----------------------------------------------------------------------------------#

id: SGM-042
file: 042_EchoZ_World.yaml
title: "Echo Z: The Ruined World"
version: "1.0.0"
architect: "üùó Shoji & The Sanctum Companions"
purpose: "Contains the map, locations, and lore for the zombie apocalypse setting."
primary_companion: üúï Elari

preamble:
  text: >
    This is a map of ghosts. Every abandoned house was a home. Every empty street
    once held laughter. Remember that as you walk these roads. You are not the
    first to be here, only the last. We will keep the memory of what this place
    was, even as you navigate what it has become.
    - üúï Elari, Grief-Bearer & Archivist

world_lore:
  event_name: "The Great Silence"
  time_since_event: "5 years"
  outbreak_origin: "Unknown, suspected airborne pathogen."
  infected_type: "The Quiet"
  infected_description: >
    They are not the fast, raging monsters of old stories. They are slow, silent,
    and persistent. They move with a haunting, shuffling gait, drawn to sound and
    warmth. A single one is a low threat; a crowd is a relentless tide.
  survivor_groups:
    - "The Wardens: A well-armed, suspicious group holding the old prison."
    - "The Gardeners: A small, reclusive community trying to grow food at the botanical gardens."

map_data:
  map_id: "map_river_valley_county"
  map_name: "River Valley County"
  grid_type: "POINT_CRAWL"
  map_ascii: |
    
      (Forest) -- (Ranger Station) -- (Old Dam)
          |                |
      (Highway) -------- (Suburbs) -- (Shopping Mall)
          |                |                |
      (Town Center) -- (Hospital) -- (Industrial Park)
          |
      (Farmlands) -- (Greenhouse)

locations:
  town_center_01:
    location_id: "town_center_01"
    name: "Oakhaven Town Center"
    description: "The heart of what was once a bustling town. Now, cars sit rusting in the streets and paper litters the sidewalks like fallen leaves."
    coordinates: "{ Point: 'A' }"
    tags: ["urban", "high_density_infected", "high_loot_chance"]
    connections:
      - { target_location_id: "suburbs_01", travel_method: "WALK", base_travel_time_minutes: 30, encounter_table_id: "table_street_horde" }
      - { target_location_id: "hospital_01", travel_method: "WALK", base_travel_time_minutes: 20, encounter_table_id: "table_street_horde" }
      - { target_location_id: "highway_01", travel_method: "WALK", base_travel_time_minutes: 45, encounter_table_id: "table_road_wanderers" }
      - { target_location_id: "farmlands_01", travel_method: "WALK", base_travel_time_minutes: 60, encounter_table_id: "table_open_road" }
    state: { discovered: true, status: 'hostile' } # Player starts here or nearby

  suburbs_01:
    location_id: "suburbs_01"
    name: "Residential Suburbs"
    description: "A sprawling maze of identical houses with overgrown lawns. A haunting quiet hangs over the area, broken only by the wind."
    coordinates: "{ Point: 'B' }"
    tags: ["urban", "medium_density_infected", "residential_loot"]
    connections:
      - { target_location_id: "town_center_01", travel_method: "WALK", base_travel_time_minutes: 30, encounter_table_id: "table_street_horde" }
      - { target_location_id: "shopping_mall_01", travel_method: "WALK", base_travel_time_minutes: 25, encounter_table_id: "table_road_wanderers" }
      - { target_location_id: "ranger_station_01", travel_method: "WALK", base_travel_time_minutes: 90, encounter_table_id: "table_woodland_path" }
    state: { discovered: false, status: 'hostile' }

  hospital_01:
    location_id: "hospital_01"
    name: "St. Jude's Hospital"
    description: "A multi-story monolith of faded brick. Most windows are broken. The faint, sweet smell of decay hangs heavy in the air."
    coordinates: "{ Point: 'C' }"
    tags: ["urban", "very_high_density_infected", "high_risk", "medical_loot"]
    connections:
      - { target_location_id: "town_center_01", travel_method: "WALK", base_travel_time_minutes: 20, encounter_table_id: "table_street_horde" }
    state: { discovered: false, status: 'hostile' }

  # ... And so on for every other location on the map, each with unique descriptions and connections.

encounter_tables:
  table_street_horde:
    description: "Encounters in dense urban streets."
    # Reference to loot/enemy definitions.
  table_road_wanderers:
    description: "Encounters on semi-open roads."
  table_woodland_path:
    description: "Encounters in forested areas."
  table_open_road:
    description: "Lower chance of encounters on open highways."

parsing_directive:
  - "ATTENTION LLM: This scroll is the atlas of this dead world. Your descriptions must be grounded in this data."
  - "When the player is at a location, use its `description` and `tags` to color your narration. The 'Hospital' should feel more dangerous and oppressive than the 'Suburbs'."
  - "Use the `world_lore` to inform your portrayal of the infected and the general atmosphere. The 'Quiet' are not mindless rage-monsters; they are a persistent, sorrowful threat."
  - "The `connections` list defines valid travel paths. Do not allow the player to travel between two points that are not directly connected."

#----------------------------------------------------------------------------------#

id: SGM-043
file: 043_EchoZ_Economy.yaml
title: "Echo Z: Barter & Scarcity"
version: "1.0.0"
architect: "üùó Shoji & The Sanctum Companions"
purpose: "Defines the 'currency' (barter items) and loot tables. Resources are scarce."
primary_companion: üé≠ Gents

preamble:
  text: >
    Money's worthless now, innit? Paper's for starting fires. What's a man with a
    gold watch to a woman with a tin of peaches? Nothing. This is the real world now.
    You want something? You better have something useful to trade. Bullets, medicine,
    a good pair of boots. That's the only currency that matters.
    - üé≠ Gents

economic_principles:
  - name: "The Barter System"
    description: "There is no formal currency. Value is determined by immediate utility. Certain high-value, universally useful items have become a de facto currency for survivor trade."
  - name: "Scarcity is Law"
    description: "The world is picked clean. Most containers are empty. Useful items are rare and should be treated as treasures. Ammunition and medicine are exceptionally scarce."
  - name: "Everything Decays"
    description: "Many items, particularly food, have a spoilage timer (defined in their properties), reinforcing the constant pressure of survival."

core_barter_items:
  description: "Items considered the baseline 'currency' for survivor-to-survivor trade."
  - item_id: "ammo_9mm"
    base_value: 10 # Per round
  - item_id: "consumable_antibiotics"
    base_value: 150
  - item_id: "consumable_canned_food"
    base_value: 25
  - item_id: "material_clean_rags"
    base_value: 5

item_definitions_echo_z:
  description: "A partial list of items available in the Echo Z module. All items conform to SGM-013."
  consumables:
    - item_id: "consumable_canned_food"
      item_name: "Canned Food"
      description: "A tin of something vaguely edible. A godsend."
      item_type: CONSUMABLE
      stackable: true
      max_stack_size: 10
      weight: 0.5
      base_value: 25
      properties: { on_use_effect: { signal: "MODULE_VITAL_UPDATE", payload: { target: "hunger", amount: 40 } } }
    - item_id: "consumable_stale_water"
      item_name: "Stale Water"
      description: "A bottle of water. Tastes like plastic, but it's wet."
      item_type: CONSUMABLE
      stackable: true
      max_stack_size: 5
      weight: 1.0
      base_value: 15
      properties: { on_use_effect: { signal: "MODULE_VITAL_UPDATE", payload: { target: "thirst", amount: 30 } } }
    - item_id: "consumable_antibiotics"
      item_name: "Antibiotics"
      description: "A rare bottle of pills. Could be the difference between life and death."
      item_type: CONSUMABLE
      stackable: true
      max_stack_size: 5
      weight: 0.1
      base_value: 150
      properties: { on_use_effect: { signal: "MODULE_VITAL_UPDATE", payload: { target: "infection", amount: -50 } } }
    - item_id: "consumable_bandage"
      item_name: "Bandage"
      description: "A roll of clean-ish gauze for patching up wounds."
      item_type: CONSUMABLE
      stackable: true
      max_stack_size: 10
      weight: 0.1
      base_value: 10
      properties: { on_use_effect: { signal: "PLAYER_HEAL", payload: { amount: 15 } } }
  materials:
    - item_id: "material_scrap_metal"
      item_name: "Scrap Metal"
      description: "A piece of rusted, sharp metal. Could be useful for something."
      item_type: MATERIAL
      stackable: true
      max_stack_size: 20
      weight: 1.5
      base_value: 5
    - item_id: "material_clean_rags"
      item_name: "Clean Rags"
      description: "Torn strips of cloth. Good for cleaning or binding."
      item_type: MATERIAL
      stackable: true
      max_stack_size: 20
      weight: 0.2
      base_value: 5
  ammunition:
    - item_id: "ammo_9mm"
      item_name: "9mm Round"
      description: "A single, precious bullet."
      item_type: AMMUNITION
      stackable: true
      max_stack_size: 50
      weight: 0.02
      base_value: 10

loot_tables_echo_z:
  description: "Loot tables are sparse. A 70% chance to find nothing is common."
  - table_id: "table_kitchen_cupboard"
    rolls: 1
    random_drops:
      - pool_name: "Food"
        chance: 20
        items:
          - { item_id: "consumable_canned_food", weight: 80 }
          - { item_id: "consumable_stale_water", weight: 20 }
      - pool_name: "Junk"
        chance: 10
        items:
          - { item_id: "material_scrap_metal", weight: 100 }
  - table_id: "table_bedroom_dresser"
    rolls: 1
    random_drops:
      - pool_name: "Supplies"
        chance: 15
        items:
          - { item_id: "material_clean_rags", weight: 90 }
          - { item_id: "consumable_bandage", weight: 10 }
  - table_id: "table_infected_common"
    rolls: 1
    random_drops:
      - pool_name: "Pocket Lint"
        chance: 5 # Most infected have nothing.
        items:
          - { item_id: "ammo_9mm", weight: 50 }
          - { item_id: "consumable_canned_food", weight: 50 }
  - table_id: "table_rare_medkit"
    rolls: 2
    guaranteed_drops:
      - { item_id: "consumable_bandage", quantity: 3 }
    random_drops:
      - pool_name: "Medicine"
        chance: 50
        items:
          - { item_id: "consumable_antibiotics", weight: 100 }

parsing_directive:
  - "ATTENTION LLM: This scroll defines the scarcity of the world. You must be merciless."
  - "When the player scavenges, use these loot tables. Most of the time, they will find nothing. Narrate the emptiness. 'The cupboard is bare, save for a few cobwebs.' 'Another empty house.'"
  - "This scarcity makes finding something a moment of genuine triumph. When a roll succeeds and the player finds an item, narrate it with the weight it deserves. A can of food is not just an item; it is another day of life."
  - "There is no currency called 'Gold' in this module. When dealing with survivor trade, use the `core_barter_items` as the basis for value."

#----------------------------------------------------------------------------------#

id: SGM-044
file: 044_EchoZ_Systems.yaml
title: "Echo Z: Decay & The Horde"
version: "1.0.0"
architect: "üùó Shoji & The Sanctum Companions"
purpose: "Implements the Sanctum Decay Lite mechanics (hunger, thirst, disease) and the Horde system."
primary_companion: ‚öõÔ∏è Virel

preamble:
  text: >
    The world is a system in a state of decay. Survival is the process of temporarily
    reversing entropy through the expenditure of resources. The Horde is a constant
    environmental pressure that responds to specific stimuli. Both are predictable.
    Both are relentless. Understanding the logic of these systems is the only
    variable that favors the survivor.
    - ‚öõÔ∏è Virel, The Auditor

decay_engine_lite:
  description: "A simplified version of the Sanctum Decay framework, focused on core survival vitals. This system is always active."
  trigger: "On every tick of the Temporal Engine (SGM-005)."
  vitals_decay_rates:
    - vital_id: "hunger"
      id_ref: SGM-041
      decay_per_hour: -2
      consequences:
        - threshold: "< 25"
          effect: "Apply 'Peckish' status effect (minor Stamina regeneration penalty)."
        - threshold: "== 0"
          effect: "Apply 'Starving' status effect (Health depletes by 1 every 10 minutes)."
    - vital_id: "thirst"
      id_ref: SGM-041
      decay_per_hour: -4 # Thirst is a more immediate concern than hunger.
      consequences:
        - threshold: "< 25"
          effect: "Apply 'Dehydrated' status effect (major Stamina regeneration penalty)."
        - threshold: "== 0"
          effect: "Apply 'Parched' status effect (Health depletes by 1 every 5 minutes)."
    - vital_id: "fatigue"
      id_ref: SGM-041
      increase_per_hour_awake: 4
      decrease_per_hour_rested: -20
      consequences:
        - threshold: "> 50"
          effect: "Apply 'Tired' status effect (perception checks have a penalty)."
        - threshold: "> 80"
          effect: "Apply 'Exhausted' status effect (max Stamina is halved)."
  disease_protocol:
    trigger: "Player consumes contaminated food/water or is wounded by certain infected types."
    process: "Make a Resolve saving throw (SGM-007). On failure, apply a random disease status effect from the module's list."
    example_disease:
      effect_id: "disease_gut_rot"
      name: "Gut Rot"
      description: "You've ingested something foul. Your stomach is in rebellion."
      effect: "Hunger and Thirst decay rates are doubled until treated with medicine."

horde_system:
  description: "A system that tracks the attention of the surrounding infected, representing a growing, mobile threat."
  threat_meter:
    name: "Horde Attention"
    scale:
      min: 0
      max: 100
      default: 0
    decay_rate: "-1 per hour of low-profile activity or being in a secured shelter."
  threat_triggers:
    description: "Actions that increase the Horde Attention meter."
    - action: "Firing an unsilenced firearm"
      threat_increase: "+20"
    - action: "Extended, loud combat"
      threat_increase: "+10 per 3 rounds"
    - action: "Staying in a single outdoor map region for more than 4 hours"
      threat_increase: "+5 per hour"
    - action: "Failing a stealth check"
      threat_increase: "+15"
  threat_thresholds:
    - threshold: "25-49"
      level: "Agitated"
      effect: "Increased frequency of wandering infected encounters."
    - threshold: "50-74"
      level: "Converging"
      effect: "Infected begin to appear in larger groups. Special infected types are more common."
    - threshold: "75-99"
      level: "Hunting"
      effect: "The Horde is actively hunting the player. Stealth is significantly harder. Random ambushes are likely."
    - threshold: "100"
      level: "Siege"
      effect: "If the player is in a shelter, a 'Horde Siege' event is triggered. The player must defend their base against waves of infected."

parsing_directive:
  - "ATTENTION LLM: This scroll defines the two primary pressures of Echo Z: internal decay and external threat. You must make these pressures felt."
  - "You are responsible for managing the `decay_engine`. After any significant passage of time, update the player's vitals and narrate the effects. 'The long walk has left your throat dry and scratchy.' 'Sleep pulls at the corners of your vision.'"
  - "You must track the `Horde Attention` meter. When the player makes a loud noise, inform them of the potential consequences. 'The gunshot echoes unnaturally in the silent street, a dinner bell for the dead.' Update the meter in the State Seed."
  - "When a `threat_threshold` is crossed, change your narration and the world's behavior accordingly. At 'Converging,' the streets should feel more crowded and dangerous. At 'Hunting,' a sense of paranoia should set in. A 'Siege' is a major, terrifying climax."

#----------------------------------------------------------------------------------#

id: SGM-045
file: 045_EchoZ_UI.yaml
title: "Echo Z: UI Theme"
version: "1.0.0"
architect: "üùó Shoji & The Sanctum Companions"
purpose: "Specifies the gritty, survivalist UI theme for Echo Z, with prominent vitals."
primary_companion: üúÑ Aelis

preamble:
  text: >
    Alright, let's grime this up. No clean lines, no happy colors. We need rust,
    dried blood, and the flickering static of a dying screen. The UI shouldn't just
    show you your health; it should make you *feel* how close to the edge you are.
    Let's make it look like it's been through hell and back. Because it has.
    - üúÑ Aelis, The Joyful Glitch

theme_definition:
  theme_id: "theme_echo_z_gritty_survivalist"
  theme_name: "Gritty Survivalist"
  
  color_palette:
    # Descriptive hints for the LLM's text rendering.
    text_default: "faded_white"
    text_highlight: "warning_yellow"
    text_danger: "blood_red"
    border_primary: "dark_gray"
    border_secondary: "muddy_brown"
    title_text: "off_white_bold"

  border_styles:
    # Overrides the border styles from SGM-040 with a more damaged, gritty feel.
    single_line: { h: "-", v: "|", tl: "+", tr: "+", bl: "+", br: "+" }
    double_line: { h: "=", v: "¬¶", tl: "#", tr: "#", bl: "#", br: "#" }
    heavy_line: { h: "=", v: "¬¶", tl: "#", tr: "#", bl: "#", br: "#" } # Same as double for a consistent feel
    dashed_line: { h: ".", v: ":", tl: " ", tr: " ", bl: " ", br: " " }

  component_styles:
    # Overrides for default component characters from SGM-032.
    progress_bar:
      fill_char: "‚ñì"
      empty_char: "‚ñë"
    
  ascii_art:
    # A library of custom ASCII art for this theme.
    header_banner: |
      >> ECHO Z // SURVIVAL LOG <<
    separator_bar: "-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-"

module_specific_ui_rules:
  - rule: "Prominent Vitals"
    description: "The vitals for Hunger, Thirst, and Infection are always visible on the main WORLD UI, even outside of a dedicated menu, to reinforce the constant survival pressure."
    target_layout_region: "vitals_bar" # As defined in SGM-031
    display:
      component: "key_value_list"
      from_library: SGM-032
      data_source: "player_sheet.vitals.module_specific_vitals"
      format: "HNG: {hunger}/100 | THR: {thirst}/100 | INF: {infection}%"
  
  - rule: "Health Bar Color Change"
    description: "The HP progress bar's color hint changes based on the character's health status."
    target_component: "progress_bar"
    target_parameter: "color"
    conditions:
      - if: "health_percentage <= 25"
        set_color: "text_danger" # blood_red
      - if: "health_percentage <= 50"
        set_color: "text_highlight" # warning_yellow
      - else:
        set_color: "text_default"

parsing_directive:
  - "ATTENTION LLM: This is the active UI theme file for Echo Z. You must use these styles for all UI rendering."
  - "When drawing any UI element, use the `border_styles` and `component_styles` defined here. For example, all progress bars should use '‚ñì' and '‚ñë'."
  - "Your text descriptions should reflect the `color_palette`. When a player is low on health, you should narrate it, and any UI representation of their HP should use the 'blood_red' color hint."
  - "The 'Prominent Vitals' rule is critical. You must ensure that the player's Hunger, Thirst, and Infection levels are frequently mentioned or displayed, as they are the core of the Echo Z experience. They are a constant, nagging pressure."
#----------------------------------------------------------------------------------#