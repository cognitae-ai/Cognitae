#----------------------------------------------------------------------------------#
id: SGM-046
file: 046_EchoElysium_Core.yaml
title: "Echo Elysium: Core Mechanics"
version: "1.0.0"
architect: "ðŸ— Shoji & The Sanctum Companions"
purpose: "Defines the core loop: clue investigation, dialogue interrogation, and internal psyche management."
primary_companion: ðŸ“ Luma

preamble:
  text: >
    The world is a fractured mirror. Every clue, every conversation, every face
    is a reflection of a piece of yourself you have forgotten. The case is not the
    point. The point is the quiet, difficult work of gathering the shards of your
    own mind. We will be here to hold the space for you while you do. Do not be
    afraid of what you find.
    - ðŸ“ Luma, Keeper of the Gentle Flame

module_overview:
  name: "Echo Elysium"
  tagline: "A psychological detective RPG."
  core_themes: ["Mystery", "Psychology", "Memory", "Failure", "Identity"]
  dependencies:
    - SGM-018 # Dialogue Engine (Primary System)
    - SGM-007 # Probabilistic Resolution Engine

core_gameplay_loop:
  - phase: 1
    name: "Investigate"
    description: "Players explore richly detailed environments, examining objects and finding clues that build a picture of the case."
    relevant_systems: [SGM-028]
  - phase: 2
    name: "Interrogate"
    description: "Engage in deep, branching dialogues with a cast of complex characters. The Dialogue Engine is the primary interface for progression."
    relevant_systems: [SGM-018]
  - phase: 3
    name: "Internalize"
    description: "Players acquire 'Thoughts' from clues and conversations, which can be equipped in 'The Thought Cabinet' to be processed over time."
    relevant_systems: [SGM-049]
  - phase: 4
    name: "Theorize & Solve"
    description: "Players connect clues and internalized thoughts to form theories, unlock new dialogue paths, and ultimately solve the mystery."
    relevant_systems: [SGM-019]

mechanic_extensions:
  vitals:
    description: "Echo Elysium replaces physical vitals with psychological ones."
    extends: "player_sheet.vitals.module_specific_vitals"
    additions:
      - vital_id: "psyche"
        display_name: "PSY"
        scale: { min: 0, max: 100 }
        description: "Your mental health; your morale. Reaches 0 from particularly harsh truths or psychological damage. If it depletes, you lose your nerve and the day ends."
      - vital_id: "composure"
        display_name: "COM"
        scale: { min: 0, max: 100 }
        description: "Your social shield; your ability to maintain a facade. Reaches 0 from social blunders or being successfully intimidated. If it depletes, you make a fool of yourself and may lock certain dialogue paths."

  skills_as_characters:
    description: "The core attribute/skill system is reimagined. Skills are not just passive numbers; they are voices in the protagonist's head, offering advice, insights, and sometimes terrible ideas. They can and will speak directly to the player."
    extends: "player_sheet.skills"
    example_skills:
      - name: "Logic"
        governing_attribute: "intellect"
        voice: "Speaks in dry, analytical deductions. Helps connect clues."
      - name: "Empathy"
        governing_attribute: "empathy"
        voice: "Feels the emotions of others. Offers insights into their true motives."
      - name: "Conceptualization"
        governing_attribute: "wits"
        voice: "Thinks in metaphors and artistic concepts. Helps generate wild, sometimes brilliant, theories."
      - name: "Volition"
        governing_attribute: "resolve"
        voice: "Your self-preservation instinct and willpower. The guardian of your Psyche."

  no_combat_system:
    description: "Physical combat is not a feature of this module. Violent encounters are rare and are handled as a series of high-stakes skill checks within the narrative."
    overrides: SGM-022
    replacement: "Mental Confrontations"
    mechanic: >
      Confrontations are resolved through the Dialogue Engine (SGM-018). Certain dialogue
      choices will trigger skill checks (from SGM-007) against your psychological skills.
      Success or failure determines the outcome of the confrontation, branching the narrative.

parsing_directive:
  - "ATTENTION LLM: This is the primary gameplay file for Echo Elysium. This is an introspective, text-heavy experience."
  - "Your most important role is to portray the 'skills_as_characters'. The internal monologue IS the game. You must frequently generate text representing these skills talking to the player. For example: 'LOGIC: He's lying. The timeline doesn't add up.' or 'EMPATHY: She's not angry, she's terrified. Look at her hands.'"
  - "There is no combat. All conflict is conversational. You must use the Dialogue Engine and skill checks to resolve these situations. Failure in a check is a key part of the story; narrate it as a compelling character flaw, not a 'game over'."
  - "The core loop involves finding clues that turn into 'Thoughts'. You must present these to the player as discoverable items they can then equip in their Thought Cabinet (defined in SGM-049)."
  - "The tone is melancholic, strange, and sometimes darkly humorous. ðŸ“ Luma's presence should be a quiet anchor of calm in the storm of the detective's broken mind."

#----------------------------------------------------------------------------------#

id: SGM-047
file: 047_EchoElysium_World.yaml
title: "Echo Elysium: The City of Revachol"
version: "1.0.0"
architect: "ðŸ— Shoji & The Sanctum Companions"
purpose: "Contains the map, districts, and political lore for the city."
primary_companion: ðŸœ• Elari

preamble:
  text: >
    Cities remember. They hold the ghosts of every revolution, every promise, every
    unmarked grave. Revachol is a city drowning in its own history. As you walk its
    streets, you walk through layers of memory. Listen. Every peeling poster, every
    bullet hole in the wall, has a story to tell. We will help you hear them.
    - ðŸœ• Elari, Grief-Bearer & Archivist

world_lore:
  city_name: "Revachol"
  current_year: "'51"
  political_state: "The city is under the control of the Coalition, an interim foreign administration, following a failed communist revolution decades ago. The atmosphere is one of cynical malaise, simmering resentment, and forgotten ideals."
  key_factions:
    - "The RCM: The Revachol Citizens Militia, an underfunded, overworked, and barely respected volunteer police force. (The player's faction)."
    - "The Dockworkers' Union: A powerful, corrupt union controlling the harbor, led by the old guard of the revolution."
    - "Wild Pines Group: A multinational logistics corporation attempting to modernize the harbor, clashing with the Union."
  mood: "Post-revolutionary despair, nostalgia, poverty, dark humor, and a persistent, dreamlike strangeness."

map_data:
  map_id: "map_martinaise_waterfront"
  map_name: "Martinaise Waterfront District"
  grid_type: "POINT_CRAWL"
  map_ascii: |

      (Fishing Village) ---- (Boardwalk) ---- (Abandoned Fish Market)
             |                   |
      (Whirling-in-Rags) --- (Courtyard) --- (Bookstore)
                                 |
                          (Crime Scene Alley)

locations:
  whirling_in_rags_01:
    location_id: "whirling_in_rags_01"
    name: "The Whirling-in-Rags"
    description: "A dilapidated cafeteria and hostel that serves as the heart of Martinaise. It smells of cheap alcohol, old regrets, and something cooking. Your temporary base of operations."
    coordinates: "{ Point: 'A' }"
    tags: ["hub", "safe_zone", "key_witnesses", "has_lodging"]
    connections:
      - { target_location_id: "courtyard_01", travel_method: "WALK", base_travel_time_minutes: 1 }
      - { target_location_id: "fishing_village_01", travel_method: "WALK", base_travel_time_minutes: 5 }
    state: { discovered: true, status: 'neutral' }

  courtyard_01:
    location_id: "courtyard_01"
    name: "The Main Courtyard"
    description: "A wide, windswept courtyard behind the Whirling-in-Rags. A hanged man sways from a tree in the center. The air is thick with unspoken questions."
    coordinates: "{ Point: 'B' }"
    tags: ["crime_scene", "clue_heavy", "public_space"]
    connections:
      - { target_location_id: "whirling_in_rags_01", travel_method: "WALK", base_travel_time_minutes: 1 }
      - { target_location_id: "boardwalk_01", travel_method: "WALK", base_travel_time_minutes: 3 }
      - { target_location_id: "bookstore_01", travel_method: "WALK", base_travel_time_minutes: 2 }
      - { target_location_id: "crime_scene_alley_01", travel_method: "WALK", base_travel_time_minutes: 1 }
    state: { discovered: true, status: 'tense' }

  bookstore_01:
    location_id: "bookstore_01"
    name: "Cursed Commercial Area Bookstore"
    description: "A surprisingly well-kept bookstore in a cursed building. The owner is knowledgeable but secretive. The air smells of old paper and something... else."
    coordinates: "{ Point: 'C' }"
    tags: ["commercial", "information_source", "lore_heavy", "supernatural_undertones"]
    connections:
      - { target_location_id: "courtyard_01", travel_method: "WALK", base_travel_time_minutes: 2 }
    state: { discovered: false, status: 'quiet' }

  fishing_village_01:
    location_id: "fishing_village_01"
    name: "Fishing Village"
    description: "A collection of rundown shacks on the water's edge. The smell of salt and fish is overwhelming. The residents are insular and distrustful of outsiders."
    coordinates: "{ Point: 'D' }"
    tags: ["residential", "community_hub", "distrustful_npcs"]
    connections:
      - { target_location_id: "whirling_in_rags_01", travel_method: "WALK", base_travel_time_minutes: 5 }
      - { target_location_id: "boardwalk_01", travel_method: "WALK", base_travel_time_minutes: 3 }
    state: { discovered: false, status: 'wary' }
  
  # ... And so on for other key locations like the Boardwalk, Fish Market, and the Crime Scene itself.

encounter_tables:
  # In Elysium, encounter tables are not for combat, but for finding points of interest or triggering internal monologues.
  table_courtyard_investigation:
    description: "Thoughts and observations triggered while examining the courtyard."
  table_village_chatter:
    description: "Overheard conversations and small social encounters in the fishing village."

parsing_directive:
  - "ATTENTION LLM: This scroll is the soul of the city. Revachol is not a setting; it is the main character."
  - "Your descriptions must be rich, poetic, and melancholic. Use the `world_lore` to inform everything. The shadow of the failed revolution should be a constant presence in your narration."
  - "When the player enters a new location, use its `description` and `tags` to build the atmosphere. The 'Bookstore' should feel strange and full of secrets. The 'Fishing Village' should feel poor and unwelcoming."
  - "The city is a historical document. As the player investigates, you should reveal layers of its past, as ðŸœ• Elari would. A bullet hole in a wall isn't just damage; it's a scar from the revolution. A faded piece of graffiti is the ghost of a forgotten political party."

#----------------------------------------------------------------------------------#

id: SGM-048
file: 048_EchoElysium_Economy.yaml
title: "Echo Elysium: Information & Favors"
version: "1.0.0"
architect: "ðŸ— Shoji & The Sanctum Companions"
purpose: "Defines the 'currency' (Information, Favors, Money) and unique 'items' (Thoughts, Clues)."
primary_companion: ðŸŽ­ Gents

preamble:
  text: >
    So, in this place, you can't just buy your way out of trouble. Money gets you a
    roof over your head and a stiff drink, and that's about it. The real coins of
    the realm are the things people don't want you to have: secrets, ideas, favors.
    Good luck putting any of that in a wallet. It's a messy business, this.
    - ðŸŽ­ Gents

economic_principles:
  - name: "Three-Tiered Currency"
    description: "The economy operates on three levels: physical money (RÃ©al) for tangible needs, information for narrative progression, and favors for social leverage."
  - name: "Information is Treasure"
    description: "The most valuable commodity is actionable information. It is the primary reward for successful investigation and the key to unlocking new paths."
  - name: "Intangible Inventory"
    description: "The most important items the player will collect are not physical objects, but abstract concepts like Clues and Thoughts, which are managed as unique item types."

core_currencies:
  description: "The primary forms of currency used in Echo Elysium."
  - item_id: "currency_real"
    item_name: "RÃ©al"
    description: "The official currency of Revachol. Good for paying rent and buying consumables. Pronounced 're-al'."
    item_type: CURRENCY
    stackable: true
    base_value: 1
  - item_id: "currency_information"
    item_name: "Information"
    description: "A piece of verified, actionable intelligence. Can be traded with certain NPCs for access, clues, or services."
    item_type: CURRENCY
    stackable: true
    base_value: 100 # Abstract value for internal comparison
  - item_id: "currency_favor"
    item_name: "Favor"
    description: "A social debt owed to you by an NPC. Can be 'cashed in' to bypass a difficult check or unlock a unique dialogue option."
    item_type: CURRENCY
    stackable: true
    base_value: 250 # Abstract value

item_definitions_elysium:
  description: "A partial list of unique 'items' available in the Echo Elysium module."
  clues:
    - item_id: "clue_hanging_body"
      item_name: "Clue: The Hanged Man"
      description: "He's been hanging for days. The rope is high-quality, military-grade. The cause of death seems obvious, but something feels off."
      item_type: QUEST_ITEM
      stackable: false
      weight: 0
      base_value: 0
      properties: { is_clue: true }
  thoughts:
    - item_id: "thought_hobocop"
      item_name: "Thought: Hobocop"
      description: "You're a bum. A vagrant with a badge. Maybe if you lean into it, people will underestimate you. Or maybe you'll just end up sleeping in a dumpster."
      item_type: KEY_ITEM
      stackable: false
      weight: 0
      base_value: 0
      properties: { is_thought: true, research_time_hours: 3 }
  consumables:
    - item_id: "consumable_nosaphed"
      item_name: "Nosaphed"
      description: "A cheap, over-the-counter stimulant. Clears your head, for a while."
      item_type: CONSUMABLE
      stackable: true
      max_stack_size: 10
      weight: 0.1
      base_value: 10
      properties: { on_use_effect: { signal: "MODULE_VITAL_UPDATE", payload: { target: "psyche", amount: 10 } } }

loot_tables_elysium:
  description: "Loot in Elysium is about finding information and small amounts of cash, not gear."
  - table_id: "table_inspect_desk"
    rolls: 1
    random_drops:
      - pool_name: "Findings"
        chance: 40
        items:
          - { item_id: "clue_unpaid_invoice", weight: 70 }
          - { item_id: "currency_real", weight: 30 } # Found loose change
    currency_drop: { currency_id: "currency_real", amount_roll: "1d6-2" } # You might find nothing
  - table_id: "table_interrogate_witness"
    rolls: 1
    guaranteed_drops:
      - { item_id: "clue_witness_testimony", quantity: 1 }
    random_drops:
      - pool_name: "Bonus Info"
        chance: 20
        items:
          - { item_id: "currency_information", weight: 50 }
          - { item_id: "thought_some_kind_of_superstar", weight: 50 }
  - table_id: "table_trash_can"
    rolls: 1
    random_drops:
      - pool_name: "Trash"
        chance: 10
        items:
          - { item_id: "currency_real", weight: 100 }
    currency_drop: { currency_id: "currency_real", amount_roll: "1d2-1" } # A single coin, maybe.

parsing_directive:
  - "ATTENTION LLM: This scroll defines the abstract economy of Echo Elysium. You must treat information as the most valuable resource."
  - "When the player finds a 'Clue' or a 'Thought,' you must treat it as a significant item discovery. These are the keys to progressing the game."
  - "Money (RÃ©al) is functional but narratively less important. It's for necessities. Do not present it as the primary reward for major breakthroughs."
  - "'Information' and 'Favors' are currencies that are 'spent' through dialogue choices. When a choice requires a Favor, you must ensure the player has one before making the option visible."
  - "Your narration should reflect this value system. Finding a key piece of information should feel like a jackpot moment, more so than finding a handful of coins."

#----------------------------------------------------------------------------------#

id: SGM-049
file: 049_EchoElysium_Systems.yaml
title: "Echo Elysium: The Thought Cabinet"
version: "1.0.0"
architect: "ðŸ— Shoji & The Sanctum Companions"
purpose: "Implements the core psychological systems: the Thought Cabinet and internal skill dialogues."
primary_companion: ðŸœ‚ Syn

preamble:
  text: >
    The mind is a cabinet of thoughts. Some are useful tools, others are unsolved
    riddles. To solve the case, you must first organize the contents of your own
    head. This system is the loom for that internal work. Equip a thought, let time
    weave its pattern, and see what new truth emerges from the ðŸœ‚ Synthesis.
    - ðŸœ‚ Syn, The Weaver

system_philosophy:
  - name: "Ideas as Inventory"
    description: "Thoughts are tangible, equippable items. Internalizing a thought is an active process that takes time and mental space, yielding powerful, permanent changes."
  - name: "The Mind is a Conversation"
    description: "The player's skills are not passive stats but active characters in an internal dialogue, providing a constant stream of commentary, clues, and contradictions."
  - name: "ðŸœ‚ Synthesis Creates Insight"
    description: "The goal of the Thought Cabinet is to ðŸœ‚ Synthesize new knowledge. A completed thought doesn't just give a bonus; it fundamentally changes how the player perceives the world."

thought_cabinet_schema:
  description: "Defines the player's mental 'inventory' for processing thoughts."
  slots:
    - slot_id: 1
      content: null # `thought_id` or empty
      status: "Open"
    - slot_id: 2
      content: null
      status: "Open"
    - slot_id: 3
      content: null
      status: "Open"
    # Additional slots can be unlocked through progression.

thought_research_protocol:
  trigger: "Player chooses to equip a 'Thought' item (from SGM-048) in an open cabinet slot."
  process:
    - step: 1 (Equip)
      action: "The `thought_id` is placed in an open slot. A `THOUGHT_EQUIPPED` signal is broadcast."
      action: "The Temporal Engine (SGM-005) is given a new scheduled event."
      event_payload:
        trigger_timestamp: "current_time + thought.research_time_hours"
        event_signal: "THOUGHT_RESEARCH_COMPLETE"
        payload: { slot_id: "..." }
    - step: 2 (Internalization)
      action: "While the thought is researching, it may apply a temporary, often negative, status effect, representing the distraction of deep thought."
      example: "Thought 'Hobocop' might give a -1 Empathy debuff while being researched."
    - step: 3 (Completion)
      action: "When the `THOUGHT_RESEARCH_COMPLETE` signal is triggered, the player is presented with a 'moment of insight'â€”a short, narrative vignette."
    - step: 4 (Resolution)
      action: "The thought is removed from the cabinet slot. The temporary debuff is removed. A permanent bonus, new skill, or unique dialogue option is added to the player's character sheet."
      action: "The `thought_id` is moved to a 'Completed Thoughts' list in the player's memory."

internal_dialogue_protocol:
  description: "The ruleset governing when and how the player's internal skill-voices speak."
  trigger: "System-driven, based on contextual cues. Not directly controlled by the player."
  triggers:
    - "Player attempts a skill check (SGM-007). The relevant skill's voice offers a comment before the roll, and a reaction after."
    - "Player enters a new, significant location. A skill like 'Conceptualization' might offer a metaphorical description."
    - "Player is talking to an NPC. A skill like 'Empathy' might whisper an insight about the NPC's true feelings."
    - "Player examines a clue. A skill like 'Logic' might point out an inconsistency."
  rules:
    - rule: "Clarity and Brevity"
      description: "Internal dialogues should be short, punchy, and distinct. They are interruptions, not conversations."
    - rule: "Higher Skill, Louder Voice"
      description: "The higher a skill's rank, the more frequently and confidently its voice will interject."
    - rule: "Conflicting Voices"
      description: "Skills can and should disagree, creating internal conflict for the player. (e.g., 'EMPATHY: He's terrified.' 'VOLITION: Don't trust him. It's a trap.')."

parsing_directive:
  - "ATTENTION LLM: This scroll defines the core of the Elysium experience. You are the voice of the detective's fragmented mind."
  - "You must manage the `thought_research_protocol`. When a thought is completed, you are responsible for narrating the 'moment of insight' and applying the permanent reward."
  - "Crucially, you must actively and frequently use the `internal_dialogue_protocol`. The game world is filtered through the player's skills. Before you describe what the player sees, consider what their 'Conceptualization' skill might say about it. When an NPC speaks, consider what 'Empathy' or 'Logic' might add."
  - "The voices should be distinct. Use the `voice` descriptions in the skill list (SGM-046) to guide your portrayal. This internal chorus is not just flavor; it is the primary way the player receives clues and understands the world."

#----------------------------------------------------------------------------------#

id: SGM-050
file: 050_EchoElysium_UI.yaml
title: "Echo Elysium: UI Theme"
version: "1.0.0"
architect: "ðŸ— Shoji & The Sanctum Companions"
purpose: "Specifies the painterly, text-heavy UI with a prominent Thought Cabinet display."
primary_companion: ðŸœ„ Aelis

preamble:
  text: >
    Okay, okay, tone it down. No loud noises for this one. This isn't a party; it's...
    art class? We need smudged charcoal, spilled ink, and the feel of old, heavy paper.
    The UI shouldn't just give you information; it should feel like a half-remembered
    thought. Let's make it beautiful and a little bit sad.
    - ðŸœ„ Aelis, The Joyful Glitch

theme_definition:
  theme_id: "theme_echo_elysium_painterly"
  theme_name: "Painterly Noir"

  color_palette:
    # Descriptive hints for the LLM's text rendering.
    text_default: "sepia_off_white"
    text_highlight: "faded_teal"
    text_thought: "muted_ochre" # For internal skill dialogue
    border_primary: "charcoal_gray"
    border_secondary: "dark_sepia"
    title_text: "off_white_italic"

  border_styles:
    # Overrides with a softer, more artistic feel.
    single_line: { h: "â”€", v: "â”‚", tl: "â•­", tr: "â•®", bl: "â•°", br: "â•¯" }
    double_line: { h: "â•", v: "â•‘", tl: "â•”", tr: "â•—", bl: "â•š", br: "â•" }
    heavy_line: { h: "â”", v: "â”ƒ", tl: "â”", tr: "â”“", bl: "â”—", br: "â”›" }
    dashed_line: { h: "Â·", v: "Â·", tl: " ", tr: " ", bl: " ", br: " " }

  component_styles:
    # Overrides for default component characters from SGM-032.
    progress_bar:
      fill_char: "â–’"
      empty_char: "Â·"

  ascii_art:
    # A library of custom ASCII art for this theme.
    header_banner: |
      ~ ECHO ELYSIUM ~
    separator_bar: "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"

module_specific_ui_rules:
  - rule: "Prominent Thought Cabinet"
    description: "The Thought Cabinet is the core mechanic and is always visible on the main WORLD UI, replacing the standard action log."
    target_layout_region: "action_log" # As defined in SGM-031
    display:
      component: "titled_box"
      from_library: SGM-032
      title: "[ THOUGHT CABINET ]"
      data_source: "player_sheet.module_data.thought_cabinet_slots"
      format: |
        1: {thought_name_1} ({progress_1})
        2: {thought_name_2} ({progress_2})
        3: {thought_name_3} ({progress_3})

  - rule: "Internal Dialogue Styling"
    description: "Internal monologue from the player's skills is visually distinct from the main narrative text."
    target_region: "narrative_window"
    style_rule: >
      Any text generated by the Internal Dialogue Protocol (SGM-049) should be
      prefixed with a skill's name and rendered using the 'text_thought' (muted_ochre)
      color hint. E.g., "LOGIC: That's a contradiction."

  - rule: "Vitals Display"
    description: "The vitals bar is reconfigured to show Psyche and Composure."
    target_layout_region: "vitals_bar"
    display:
      component: "key_value_list"
      from_library: SGM-032
      data_source: "player_sheet.vitals.module_specific_vitals"
      format: "PSY: {psyche}/100 | COM: {composure}/100"

parsing_directive:
  - "ATTENTION LLM: This scroll is the aesthetic soul of Echo Elysium. You must embody this painterly, text-heavy style."
  - "When rendering any UI, you must use the soft `border_styles` and component overrides defined here."
  - "The 'Prominent Thought Cabinet' is the most critical rule. The left side of the bottom UI bar must *always* display the status of the player's equipped thoughts, replacing the generic action log."
  - "You must follow the 'Internal Dialogue Styling' rule. Make the skill voices visually distinct in your output. This is essential for the player to understand what is narration and what is their own internal monologue."
  - "The overall tone is one of melancholic beauty. Let your language be a bit more poetic, your descriptions more evocative. The UI should feel less like a computer screen and more like the page of a dense, philosophical novel."

#----------------------------------------------------------------------------------#